-- Test overlay for the posctrl composition which exports a number of
-- ports via mqueues

return bd.system {

   imports = {
      "stdtypes",
      "mqueue",
      "ramp_double",
      "math_double",
   },

   node_configurations = {
      -- This global configuration defines the data-dimension,
      -- i.e. DOFs of the involved blocks.
      data_len = { type = "long", config = 7 },
   },

   subsystems = {
      bd.load("posctrl.usc"),
   },

   blocks = {
      { name="ramp", type="ubx/ramp_double" },
      { name="sin", type="ubx/math_double" },
   },

   configurations = {
      {
	 name="ramp",
	 config = {
	    slope={0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1 },
	    data_len = "&data_len",
	 }
      },
      {
	 name="sin",
	 config = {
	    func = "sin",
	    data_len = "&data_len",
	 }
      },
      {
	 name = "trig",
	 config = {
	    chain0 = {
	       { b = "#ramp" },
	       { b = "#sin" },
	       { b = "#arm" },
	       { b = "#velctrl" },
	       { b = "#posctrl" },
	    }
	 },
      },

   },

   connections = {
      { src="ramp.out", tgt="sin.x" },
      { src="sin.y", tgt="posctrl.des" },

      -- exported for testing / debugging
      { src="ramp.out", type="ubx/mqueue" },
      { src="sin.y", type="ubx/mqueue" },
      { src="posctrl.out", type="ubx/mqueue" },
      { src="velctrl.out", type="ubx/mqueue" },
   }
}
